Retry GatewayFilter 工厂支持以下参数。

+ retries: 应该尝试的重试次数。
+ statuses: 应该重试的HTTP状态代码，用 org.springframework.http.HttpStatus 表示。
+ methods: 应该重试的HTTP方法，用 org.springframework.http.HttpMethod 来表示。
+ series: 要重试的状态代码系列，用 org.springframework.http.HttpStatus.Series 表示。
+ exceptions: 抛出的异常的列表，应该重试。
+ backoff: 为重试配置的指数式backoff。重试是在 backoff 间隔 firstBackoff * (factor ^ n) 之后进行的，其中 n 是迭代次数。如果配置了 maxBackoff，应用的最大 backoff 时间被限制在 maxBackoff。如果 basedOnPreviousValue 为 true，则通过使用 prevBackoff * factor 来计算backoff。

如果启用，为 Retry filter 配置的默认值如下。

+ retries: 三次
+ series: 5XX系列
+ methods: GET 请求
+ exceptions: IOException 和 TimeoutException
+ backoff: disabled

下面配置了一个 Retry GatewayFilter。

_Example 59. application.yml_

```plain
spring:
  cloud:
    gateway:
      routes:
      - id: retry_test
        uri: http://localhost:8080/flakey
        predicates:
        - Host=*.retry.com
        filters:
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY
            methods: GET,POST
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false
```



| 当使用带有 forward: 前缀的URL的 retry filter 时，应仔细编写目标端点，以便在出现错误时，它不会做任何可能导致响应被发送到客户端并提交的事情。例如，如果目标端点是一个 @Controller，目标controller方法不应该返回带有错误状态码的 ResponseEntity。相反，它应该抛出一个 Exception 或发出一个错误信号（例如，通过 Mono.error(ex) 返回值），retry filter 可以被配置为通过重试来处理。 |
| --- |


| 当对任何带有body的HTTP方法使用 retry filter 时，body将被缓存，网关将变得内存受限。body被缓存在 ServerWebExchangeUtils.CACHED_REQUEST_BODY_ATTR 定义的请求属性（request attribute）中。该对象的类型是 org.springframework.core.io.buffer.DataBuffer。 |
| --- |


一个简化的 "快捷" 方式可以用一个 status 和 method 来添加。

以下两个例子是等同的。

_Example 60. application.yml_

```plain
spring:
  cloud:
    gateway:
      routes:
      - id: retry_route
        uri: https://example.org
        filters:
        - name: Retry
          args:
            retries: 3
            statuses: INTERNAL_SERVER_ERROR
            methods: GET
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false

      - id: retryshortcut_route
        uri: https://example.org
        filters:
        - Retry=3,INTERNAL_SERVER_ERROR,GET,10ms,50ms,2,false
```







  


