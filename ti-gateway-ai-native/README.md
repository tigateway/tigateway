# TiGateway AI Native

TiGateway AI Native æ˜¯ä¸€ä¸ªä¸“ä¸ºAIåº”ç”¨è®¾è®¡çš„åŸç”ŸAPIç½‘å…³ï¼Œæä¾›å®Œæ•´çš„AIå¼€å‘ã€å®‰å…¨é˜²æŠ¤ã€å¤šæ¨¡å‹é€‚é…å’Œå¯è§‚æµ‹æ€§åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. AIå¼€å‘æ’ä»¶é›†
- **LLMç¼“å­˜**: æä¾›LLMå“åº”çš„ç¼“å­˜åŠŸèƒ½ï¼Œæé«˜æ€§èƒ½å¹¶é™ä½æˆæœ¬
- **æç¤ºè¯æ¨¡æ¿**: ç®¡ç†å’Œåº”ç”¨æç¤ºè¯æ¨¡æ¿ï¼Œæ ‡å‡†åŒ–AIäº¤äº’
- **æç¤ºè¯è£…é¥°å™¨**: åŠ¨æ€è£…é¥°å’Œå¢å¼ºæç¤ºè¯å†…å®¹
- **è¯·æ±‚è½¬æ¢**: é€‚é…ä¸åŒAIæœåŠ¡çš„è¯·æ±‚æ ¼å¼
- **å“åº”è½¬æ¢**: æ ‡å‡†åŒ–AIæœåŠ¡çš„å“åº”æ ¼å¼
- **å‘é‡æ£€ç´¢**: é›†æˆå‘é‡æ•°æ®åº“ï¼Œæ”¯æŒRAGåº”ç”¨

### 2. AIå®‰å…¨é˜²æŠ¤
- **å†…å®¹å®¡æ ¸**: é›†æˆé˜¿é‡Œäº‘å†…å®¹å®‰å…¨ï¼Œæä¾›å¤šç»´åº¦å†…å®¹å®¡æ ¸
- **Tokené™æµ**: åŸºäºTokenä½¿ç”¨é‡çš„æ™ºèƒ½é™æµ
- **Tokené…é¢**: ç”¨æˆ·çº§åˆ«çš„Tokenä½¿ç”¨é…é¢ç®¡ç†

### 3. å¤šæ¨¡å‹é€‚é…
- **AIä»£ç†**: ç»Ÿä¸€çš„AIæœåŠ¡ä»£ç†ï¼Œæ”¯æŒåè®®è½¬æ¢
- **é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
- **Fallback**: æ™ºèƒ½é™çº§å’Œå¤‡ç”¨æ¨¡å‹åˆ‡æ¢
- **æ¨¡å‹ç®¡ç†**: æ”¯æŒå¤šç§AIæ¨¡å‹æä¾›å•†

### 4. å¯è§‚æµ‹æ€§
- **AIç»Ÿè®¡**: å®æ—¶AIè¯·æ±‚ç»Ÿè®¡å’Œç›‘æ§
- **LLMè®¿é—®æ—¥å¿—**: è¯¦ç»†çš„LLMäº¤äº’æ—¥å¿—
- **Tokenæ¶ˆè´¹è§‚æµ‹**: Tokenä½¿ç”¨é‡å®æ—¶ç›‘æ§
- **å¯ç”¨æ€§å‘Šè­¦**: æœåŠ¡å¯ç”¨æ€§ç›‘æ§å’Œå‘Šè­¦

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TiGateway AI Native                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AIå¼€å‘æ’ä»¶é›†          â”‚  AIå®‰å…¨é˜²æŠ¤          â”‚  å¤šæ¨¡å‹é€‚é…    â”‚
â”‚  â€¢ LLMç¼“å­˜            â”‚  â€¢ å†…å®¹å®¡æ ¸          â”‚  â€¢ AIä»£ç†      â”‚
â”‚  â€¢ æç¤ºè¯æ¨¡æ¿          â”‚  â€¢ Tokené™æµ         â”‚  â€¢ é‡è¯•æœºåˆ¶    â”‚
â”‚  â€¢ æç¤ºè¯è£…é¥°å™¨        â”‚  â€¢ Tokené…é¢         â”‚  â€¢ Fallback   â”‚
â”‚  â€¢ è¯·æ±‚è½¬æ¢            â”‚                     â”‚  â€¢ æ¨¡å‹ç®¡ç†    â”‚
â”‚  â€¢ å“åº”è½¬æ¢            â”‚                     â”‚               â”‚
â”‚  â€¢ å‘é‡æ£€ç´¢            â”‚                     â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        å¯è§‚æµ‹æ€§                             â”‚
â”‚  â€¢ AIç»Ÿè®¡  â€¢ LLMè®¿é—®æ—¥å¿—  â€¢ Tokenæ¶ˆè´¹è§‚æµ‹  â€¢ å¯ç”¨æ€§å‘Šè­¦      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å¤–éƒ¨é›†æˆ                                â”‚
â”‚  LLMs: OpenAI, Anthropic, é˜¿é‡Œäº‘, æ™ºè°±AI, æœˆä¹‹æš—é¢...      â”‚
â”‚  å‘é‡æ•°æ®åº“: Redis, é˜¿é‡Œäº‘DashVector, é˜¿é‡Œäº‘Lindorm...     â”‚
â”‚  å†…å®¹å®¡æ ¸: é˜¿é‡Œäº‘å†…å®¹å®‰å…¨, ç¬¬ä¸‰æ–¹SaaSæœåŠ¡...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ”¯æŒçš„AIæ¨¡å‹

### OpenAI
- GPT-3.5-turbo
- GPT-4
- GPT-4-turbo

### Anthropic
- Claude-3-sonnet
- Claude-3-haiku
- Claude-3-opus

### é˜¿é‡Œäº‘
- é€šä¹‰åƒé—® (qwen-turbo, qwen-plus, qwen-max)
- é€šä¹‰ä¸‡ç›¸

### æ™ºè°±AI
- GLM-4
- GLM-3-turbo

### æœˆä¹‹æš—é¢
- moonshot-v1-8k
- moonshot-v1-32k

### å…¶ä»–
- DeepSeek
- é˜¶è·ƒæ˜Ÿè¾°
- æ–‡å¿ƒä¸€è¨€
- Google Gemini

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- Java 17+
- Spring Boot 3.2+
- Redis 6.0+
- Maven 3.6+

### 2. é…ç½®APIå¯†é’¥
```bash
export OPENAI_API_KEY=your_openai_api_key
export ANTHROPIC_API_KEY=your_anthropic_api_key
export ALIBABA_API_KEY=your_alibaba_api_key
```

### 3. å¯åŠ¨åº”ç”¨
```bash
mvn spring-boot:run
```

### 4. æµ‹è¯•AIè¯·æ±‚
```bash
curl -X POST http://localhost:8083/ai-native/ai/chat/completions \
  -H "Content-Type: application/json" \
  -H "X-Target-Model: gpt-3.5-turbo" \
  -H "X-Prompt-Template: default" \
  -d '{
    "messages": [
      {"role": "user", "content": "Hello, AI!"}
    ],
    "max_tokens": 100
  }'
```

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®
```yaml
tigateway:
  ai:
    enabled: true
    ai-development:
      llm-cache:
        enabled: true
        max-size: 1000
        ttl: 3600
    ai-security:
      content-review:
        enabled: true
        provider: alibaba
      token-rate-limit:
        enabled: true
        requests-per-minute: 100
        tokens-per-minute: 10000
```

### æ¨¡å‹é…ç½®
```yaml
tigateway:
  ai:
    multi-model:
      models:
        - name: gpt-3.5-turbo
          provider: openai
          endpoint: https://api.openai.com/v1
          api-key: ${OPENAI_API_KEY:}
          parameters:
            max-tokens: 4096
            temperature: 0.7
```

## ğŸ”Œ æ’ä»¶å¼€å‘

### è‡ªå®šä¹‰AIæ’ä»¶
```java
@Component
public class CustomAiPlugin extends AbstractGatewayFilterFactory<CustomAiPlugin.Config> {
    
    @Override
    public GatewayFilter apply(Config config) {
        return (exchange, chain) -> {
            // è‡ªå®šä¹‰AIå¤„ç†é€»è¾‘
            return chain.filter(exchange);
        };
    }
    
    public static class Config {
        // æ’ä»¶é…ç½®
    }
}
```

### è‡ªå®šä¹‰æ¨¡å‹æä¾›è€…
```java
@Component
public class CustomModelProvider implements AiProxyService.ModelProvider {
    
    @Override
    public Mono<LlmResponse> proxyRequest(LlmRequest request) {
        // è‡ªå®šä¹‰æ¨¡å‹è¯·æ±‚é€»è¾‘
        return Mono.just(new LlmResponse());
    }
}
```

## ğŸ“Š ç›‘æ§å’ŒæŒ‡æ ‡

### è®¿é—®ç»Ÿè®¡ç«¯ç‚¹
```bash
# è·å–AIç»Ÿè®¡ä¿¡æ¯
curl http://localhost:8083/ai-native/actuator/ai-stats

# è·å–PrometheusæŒ‡æ ‡
curl http://localhost:8083/ai-native/actuator/prometheus
```

### å…³é”®æŒ‡æ ‡
- `ai_requests_total`: AIè¯·æ±‚æ€»æ•°
- `ai_requests_duration_seconds`: AIè¯·æ±‚æŒç»­æ—¶é—´
- `ai_token_usage_total`: Tokenä½¿ç”¨æ€»é‡
- `ai_cache_hits_total`: ç¼“å­˜å‘½ä¸­æ¬¡æ•°
- `ai_rate_limit_exceeded_total`: é™æµè§¦å‘æ¬¡æ•°

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å†…å®¹å®¡æ ¸
- æ–‡æœ¬å†…å®¹å®¡æ ¸
- å›¾åƒå†…å®¹å®¡æ ¸
- å¤šç»´åº¦é£é™©è¯„ä¼°
- å®æ—¶æ‹¦æˆªæœºåˆ¶

### é™æµå’Œé…é¢
- åŸºäºç”¨æˆ·çš„è¯·æ±‚é™æµ
- åŸºäºTokenä½¿ç”¨é‡çš„é™æµ
- æ—¥/æœˆTokené…é¢ç®¡ç†
- æ™ºèƒ½é™çº§ç­–ç•¥

## ğŸš€ éƒ¨ç½²

### Dockeréƒ¨ç½²
```dockerfile
FROM openjdk:17-jre-slim
COPY target/ti-gateway-ai-native-1.0.0.jar app.jar
EXPOSE 8083
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### Kuberneteséƒ¨ç½²
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tigateway-ai-native
spec:
  replicas: 3
  selector:
    matchLabels:
      app: tigateway-ai-native
  template:
    metadata:
      labels:
        app: tigateway-ai-native
    spec:
      containers:
      - name: tigateway-ai-native
        image: tigateway/ai-native:1.0.0
        ports:
        - containerPort: 8083
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: ai-secrets
              key: openai-api-key
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache 2.0 è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [Higress](https://github.com/alibaba/higress) é¡¹ç›®çš„å¯å‘
- æ„Ÿè°¢æ‰€æœ‰å¼€æºAIæ¨¡å‹æä¾›å•†
- æ„Ÿè°¢ç¤¾åŒºè´¡çŒ®è€…çš„æ”¯æŒ

## ğŸ“ è”ç³»æˆ‘ä»¬

- é¡¹ç›®ä¸»é¡µ: https://github.com/your-org/tigateway
- é—®é¢˜åé¦ˆ: https://github.com/your-org/tigateway/issues
- é‚®ç®±: tigateway@example.com
