management:
  endpoint:
    health:
      show-details: when_authorized
    gateway:
      enabled: true
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,gateway
  server:
    port: 8090
  metrics:
    export:
      prometheus:
        enabled: true
      wavefront:
        enabled: false
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.95, 0.99

# Admin配置
admin:
  server:
    enabled: true
    port: 8081
    context-path: /admin
    name: tigateway-admin

# MCP配置
tigateway:
  mcp:
    enabled: true
    independent-port: false  # 设置为true启用独立端口
    port: 8082
    context-path: /mcp
    allowed-origins:
      - "*"
    authentication-enabled: false
    kubernetes:
      namespace: default
      api-server-url: ""
      service-account-token-path: "/var/run/secrets/kubernetes.io/serviceaccount/token"
      ca-cert-path: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    metrics:
      enabled: true
      collection-interval: 30
      retention-period: 24

spring:
  main:
    allow-bean-definition-overriding: true
    web-application-type: reactive
  # 抑制 BeanPostProcessor 警告
  context:
    allow-circular-references: true
  # Thymeleaf 配置 - 禁用模板位置检查（因为这是 API Gateway，不需要模板）
  thymeleaf:
    check-template-location: false
  cloud:
    loadbalancer:
      cache:
        enabled: true
        ttl: 5S
        caffeine:
          spec: maximumSize=256,expireAfterWrite=5s
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=256,expireAfterWrite=5s
    gateway:
      filter:
        token-relay:
          enabled: false
      actuator:
        verbose:
          enabled: false
      kubernetes:
        ingress:
          enabled: true
          namespace: default
          refresh-interval: 30
          cache-enabled: true
          cache-expiration: 300
          tls-enabled: true
          default-service-port: 80
          path-rewrite-enabled: true
          path-rewrite-pattern: "/(.*)"
          path-rewrite-replacement: "/$1"
      storage:
        configmap:
          enabled: true
          name: tigateway-app-config
          namespace: default
      routes:
        - id: test-route
          uri: https://httpbin.org
          predicates:
            - Path=/test/**
          filters:
            - StripPrefix=1
        # Admin 路由已集成到主应用中，不需要单独路由
        # Admin UI 通过 /admin 路径直接访问
  session:
    timeout: 30m
  kubernetes:
    discovery:
      enabled: false
    config:
      enabled: false
sso:
  roles-attribute-name: roles

# 日志配置 - 抑制各种警告
logging:
  level:
    # 抑制 BeanPostProcessorChecker 的警告（使用父类配置，因为内部类配置可能不生效）
    org.springframework.context.support.PostProcessorRegistrationDelegate: ERROR
    # 如果需要，也可以抑制 LoadBalancer 相关的其他警告
    org.springframework.cloud.client.loadbalancer: INFO
    org.springframework.cloud.loadbalancer: INFO
    # 抑制 Hazelcast CP Subsystem 警告（对于会话存储和限流，不需要 CP Subsystem）
    com.hazelcast.cp.CPSubsystem: ERROR