有些情况下，有必要读取请求体。由于请求体只能被读取一次，我们需要缓存请求体。你可以使用 CacheRequestBody 过滤器来缓存请求体，然后再把它发送到下游，从 exchange 属性中获取请求体。

下面显示了如何缓存请求体 GatewayFilter：



```plain
@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("cache_request_body_route", r -> r.path("/downstream/**")
            .filters(f -> f.prefixPath("/httpbin")
                .cacheRequestBody(String.class).uri(uri))
        .build();
}
```



_Example 29. application.yml_



```plain
spring:
  cloud:
    gateway:
      routes:
      - id: cache_request_body_route
        uri: lb://downstream
        predicates:
        - Path=/downstream/**
        filters:
        - name: CacheRequestBody
          args:
            bodyClass: java.lang.String
```



CacheRequestBody 提取请求体并将其转换为一个 body 类（比如前面例子中定义的 java.lang.String）。然后，CacheRequestBody 把它放在 ServerWebExchange.getAttributes() 提供的属性中，其KEY值在 ServerWebExchangeUtils.CACHED_REQUEST_BODY_ATTR 中定义。

| 这个过滤器只对HTTP（包括HTTPS）请求起作用。 |
| --- |


