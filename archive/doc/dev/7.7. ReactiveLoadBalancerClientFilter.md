ReactiveLoadBalancerClientFilter 在名为 ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR 的 exchange 属性中寻找一个URI。如果URL有一个 lb scheme（如 lb://myservice），它将使用Spring Cloud ReactorLoadBalancer将名称（本例中为 myservice）解析为实际的主机和端口，并替换同一属性中的URI。未修改的原始URL被追加到 ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR 属性的列表中。过滤器也会在 ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR 属性中查看是否等于 lb，如果是，同样的规则也适用。下面的列表配置了一个 ReactiveLoadBalancerClientFilter。

_Example 65. application.yml_



```plain
spring:
  cloud:
    gateway:
      routes:
      - id: myRoute
        uri: lb://service
        predicates:
        - Path=/service/**
```



| 默认情况下，当 ReactorLoadBalancer 无法找到一个服务实例时，会返回 503。你可以通过设置 spring.cloud.gateway.loadbalancer.use404=true，将网关配置为返回 404。 |
| --- |


| 从 ReactiveLoadBalancerClientFilter 返回的 ServiceInstance 的 isSecure 值覆盖了向网关发出的请求中指定的scheme。例如，如果请求通过 HTTPS 进入Gateway，但 ServiceInstance 表示它不安全，那么下游请求将通过 HTTP 进行。相反的情况也可以适用。然而，如果在网关配置中为路由指定了  GATEWAY_SCHEME_PREFIX_ATTR，那么前缀将被剥离，来自路由 URL 的结果scheme将覆盖 ServiceInstance 的配置。 |
| --- |


| Gateway 支持所有的 LoadBalancer 功能。你可以在 [Spring Cloud Commons 文档](https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer)<br/>中阅读更多关于它们的信息。 |
| --- |


