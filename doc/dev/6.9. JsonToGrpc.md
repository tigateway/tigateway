JSONToGRPCFilter GatewayFilter Factory 将一个JSON payload 转换为gRPC请求。

该过滤器需要以下参数。

+ protoDescriptor: Proto描述文件。

这个文件可以用 protoc 生成，并指定 --descriptor_set_out 标志。

```plain
protoc --proto_path=src/main/resources/proto/ \
--descriptor_set_out=src/main/resources/proto/hello.pb  \
src/main/resources/proto/hello.proto
```



+ protoFile: Proto定义文件。
+ service: 处理请求的服务的全名称。
+ method: 处理该请求的服务中的方法名称。

| 支持 streaming。 |
| --- |


**application.yml.**

```plain
spring:
  cloud:
    gateway:
      routes:
        - id: json-grpc
          uri: https://localhost:6565/testhello
          predicates:
            - Path=/json/**
          filters:
            - name: JsonToGrpc
              args:
                protoDescriptor: file:proto/hello.pb
                protoFile: file:proto/hello.proto
                service: com.example.grpcserver.hello.HelloService
                method: hello
```

```plain
@Bean
public RouteLocator routes(RouteLocatorBuilder builder) {
    return builder.routes()
            .route("json-grpc", r -> r.path("/json/hello").filters(f -> {
                String protoDescriptor = "file:src/main/proto/hello.pb";
                String protoFile = "file:src/main/proto/hello.proto";
                String service = "HelloService";
                String method = "hello";
                return f.jsonToGRPC(protoDescriptor, protoFile, service, method);
            }).uri(uri))
```



当通过网关向 /json/hello 发出请求时，该请求通过使用 hello.proto 中提供的定义进行转换，发送到 com.example.grpcserver.hello.HelloService/hello，返回的响应被转换为JSON。

默认情况下，它通过使用默认的 TrustManagerFactory 创建一个 NettyChannel。然而，你可以通过创建一个 GrpcSslConfigurer 类型的bean来定制这个 TrustManager。

```plain
@Configuration
public class GRPCLocalConfiguration {
    @Bean
    public GRPCSSLContext sslContext() {
        TrustManager trustManager = trustAllCerts();
        return new GRPCSSLContext(trustManager);
    }
}
```



  


